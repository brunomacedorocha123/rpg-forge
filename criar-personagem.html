<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Personagem - RPGForce</title>
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #2a1a3a 100%);
            min-height: 100vh;
            color: #fff;
        }

        /* Efeito de fundo */
        .magic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .magic-bg::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 50%);
            animation: pulse 8s ease-in-out infinite;
        }

        .magic-bg::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 80% 80%, rgba(198, 40, 40, 0.1) 0%, transparent 50%);
            animation: pulse 10s ease-in-out infinite reverse;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navbar */
        .navbar {
            background: rgba(10, 10, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 20px;
            padding: 15px 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-area h2 {
            font-family: 'MedievalSharp', cursive;
            font-size: 1.3rem;
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .user-id {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.3);
            padding: 6px 12px;
            border-radius: 30px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .user-id i {
            color: #ffd700;
        }

        .user-id .value {
            color: #ffd700;
            font-family: monospace;
            font-weight: 600;
        }

        .user-nick {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 215, 0, 0.1);
            padding: 6px 15px;
            border-radius: 30px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .user-nick i {
            color: #ffd700;
        }

        .btn-sair {
            background: transparent;
            border: 2px solid rgba(255, 107, 107, 0.5);
            color: #ff6b6b;
            padding: 6px 15px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-sair:hover {
            background: #ff6b6b;
            color: #0a0a1a;
            border-color: #ff6b6b;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        .breadcrumb a {
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: #ffd700;
        }

        .breadcrumb i {
            font-size: 0.7rem;
            color: rgba(255, 215, 0, 0.5);
        }

        .breadcrumb .current {
            color: #ffd700;
        }

        /* Header */
        .page-header h1 {
            font-family: 'MedievalSharp', cursive;
            font-size: 2rem;
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Card Principal */
        .card {
            background: rgba(10, 10, 26, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 30px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .card-section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        .card-section h2 {
            font-family: 'MedievalSharp', cursive;
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Formulário */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 12px 15px;
            color: #fff;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ffd700;
        }

        /* Upload */
        .upload-area {
            background: rgba(0, 0, 0, 0.2);
            border: 2px dashed rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.05);
        }

        .upload-area i {
            font-size: 2rem;
            color: #ffd700;
            margin-bottom: 10px;
            display: block;
        }

        .preview-area {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin: 10px 0;
        }

        .preview-area img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .btn-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Grids de Vantagens/Desvantagens */
        .vantagens-grid, .desvantagens-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .vantagem-card, .desvantagem-card {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .vantagem-card:hover, .desvantagem-card:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: #ffd700;
            transform: translateY(-2px);
        }

        .vantagem-card.selecionada {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .vantagem-card h3, .desvantagem-card h3 {
            font-size: 1rem;
            color: #ffd700;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vantagem-card p, .desvantagem-card p {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }

        .vantagem-card .resumo, .desvantagem-card .resumo {
            font-size: 0.7rem;
            color: rgba(255, 215, 0, 0.8);
            font-style: italic;
        }

        .vantagem-card .check {
            display: none;
            color: #ffd700;
            font-size: 1.2rem;
        }

        .vantagem-card.selecionada .check {
            display: inline;
        }

        .badge-fobia {
            background: rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-top: 5px;
            display: inline-block;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 5000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a3a;
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h3 {
            color: #ffd700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fobia-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .fobia-item:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: #ffd700;
        }

        .fobia-item h4 {
            color: #ffd700;
            margin-bottom: 5px;
        }

        .fobia-item p {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .modal-close {
            background: transparent;
            border: 2px solid #ff6b6b;
            color: #ff6b6b;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
        }

        .contador-vantagens {
            background: rgba(255, 215, 0, 0.1);
            padding: 10px 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .contador-vantagens span {
            color: #ffd700;
            font-weight: bold;
        }

        /* Atributos */
        .pontos-restantes {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #0a0a1a;
            padding: 15px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: bold;
        }

        .pontos-restantes .valor {
            font-size: 1.5rem;
            font-family: 'MedievalSharp', cursive;
        }

        .atributo-row {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .atributo-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .atributo-nome {
            font-weight: 600;
            color: #fff;
        }

        .atributo-valor {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }

        .bolinhas-container {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .bolinha {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            cursor: pointer;
            transition: all 0.2s;
        }

        .bolinha.preenchida {
            background: #ffd700;
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .bolinha:hover {
            transform: scale(1.1);
            border-color: #ffd700;
        }

        .atributo-detalhes {
            display: flex;
            gap: 15px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        /* Status Grid */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .status-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }

        .status-item .label {
            display: block;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        .status-item .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }

        /* Botões */
        .card-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #0a0a1a;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid rgba(255, 215, 0, 0.5);
            color: #ffd700;
        }

        .btn-secondary:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: #ffd700;
        }

        /* Loading */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 26, 0.9);
            z-index: 4000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 215, 0, 0.2);
            border-top-color: #ffd700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            color: #ffd700;
            font-size: 1.2rem;
            font-family: 'MedievalSharp', cursive;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .card { padding: 20px; }
            .form-row { grid-template-columns: 1fr; }
            .status-grid { grid-template-columns: repeat(2, 1fr); }
            .vantagens-grid, .desvantagens-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="magic-bg"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Carregando...</div>
    </div>

    <!-- Modal de Fobias -->
    <div class="modal" id="modalFobias">
        <div class="modal-content">
            <h3><i class="fas fa-spider"></i> Escolha uma Fobia</h3>
            
            <div class="fobia-item" data-fobia="acrofobia">
                <h4>Acrofobia</h4>
                <p>Medo de alturas. Não vai a lugares com mais de 5m de altura.</p>
            </div>
            
            <div class="fobia-item" data-fobia="agorafobia">
                <h4>Agorafobia</h4>
                <p>Medo de espaços abertos. Desconfortável sem paredes num raio de 15m.</p>
            </div>
            
            <div class="fobia-item" data-fobia="aracnofobia">
                <h4>Aracnofobia</h4>
                <p>Medo de aranhas.</p>
            </div>
            
            <div class="fobia-item" data-fobia="autofobia">
                <h4>Autofobia</h4>
                <p>Medo de solidão. Não suporta ficar sozinho.</p>
            </div>
            
            <div class="fobia-item" data-fobia="brontofobia">
                <h4>Brontofobia</h4>
                <p>Medo de ruídos altos. Evita tempestades e explosões.</p>
            </div>
            
            <div class="fobia-item" data-fobia="claustrofobia">
                <h4>Claustrofobia</h4>
                <p>Medo de espaços fechados. Pânico em lugares pequenos.</p>
            </div>
            
            <div class="fobia-item" data-fobia="coitofobia">
                <h4>Coitofobia</h4>
                <p>Medo de sexo.</p>
            </div>
            
            <div class="fobia-item" data-fobia="demofobia">
                <h4>Demofobia</h4>
                <p>Medo de multidões. Penalidade progressiva por quantidade de pessoas.</p>
            </div>
            
            <div class="fobia-item" data-fobia="ecmofobia">
                <h4>Ecmofobia</h4>
                <p>Medo de coisas afiadas. Espadas, facas, agulhas.</p>
            </div>
            
            <div class="fobia-item" data-fobia="elurofobia">
                <h4>Elurofobia</h4>
                <p>Medo de gatos.</p>
            </div>
            
            <div class="fobia-item" data-fobia="entomofobia">
                <h4>Entomofobia</h4>
                <p>Medo de insetos. Penalidade para insetos grandes ou muitos.</p>
            </div>
            
            <div class="fobia-item" data-fobia="hematofobia">
                <h4>Hematofobia</h4>
                <p>Medo de sangue. Teste durante combates.</p>
            </div>
            
            <div class="fobia-item" data-fobia="hoplofobia">
                <h4>Hoplofobia</h4>
                <p>Medo de armas. Penalidade ao ser ameaçado.</p>
            </div>
            
            <div class="fobia-item" data-fobia="manafobia">
                <h4>Manafobia</h4>
                <p>Medo de magia. Não aprende magias, reage mal a magos.</p>
            </div>
            
            <div class="fobia-item" data-fobia="misofobia">
                <h4>Misofobia</h4>
                <p>Medo de sujeira. Evita se sujar, comida estranha.</p>
            </div>
            
            <div class="fobia-item" data-fobia="necrofobia">
                <h4>Necrofobia</h4>
                <p>Medo da morte e mortos. Pânico perto de cadáveres.</p>
            </div>
            
            <div class="fobia-item" data-fobia="nictofobia">
                <h4>Nictofobia</h4>
                <p>Medo do escuro. Evita lugares subterrâneos.</p>
            </div>
            
            <div class="fobia-item" data-fobia="ofiofobia">
                <h4>Ofiofobia</h4>
                <p>Medo de répteis. Penalidade para cobras, lagartos.</p>
            </div>
            
            <div class="fobia-item" data-fobia="pirofobia">
                <h4>Pirofobia</h4>
                <p>Medo de fogo. Até cigarro aceso incomoda.</p>
            </div>
            
            <div class="fobia-item" data-fobia="psicofobia">
                <h4>Psicofobia</h4>
                <p>Medo de poderes psíquicos.</p>
            </div>
            
            <div class="fobia-item" data-fobia="talassofobia">
                <h4>Talassofobia</h4>
                <p>Medo do mar. Evita viagens marítimas.</p>
            </div>
            
            <div class="fobia-item" data-fobia="tecnofobia">
                <h4>Tecnofobia</h4>
                <p>Medo de máquinas. Não usa tecnologia avançada.</p>
            </div>
            
            <div class="fobia-item" data-fobia="teratofobia">
                <h4>Teratofobia</h4>
                <p>Medo de monstros. Penalidade progressiva.</p>
            </div>
            
            <div class="fobia-item" data-fobia="triscedecofobia">
                <h4>Triscedecofobia</h4>
                <p>Medo do número 13. Teste ao envolver o número.</p>
            </div>
            
            <div class="fobia-item" data-fobia="xenofobia">
                <h4>Xenofobia</h4>
                <p>Medo do desconhecido/estrangeiros. Penalidade para não-humanos.</p>
            </div>
            
            <button class="modal-close" id="fecharModalFobias">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <div class="container">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="logo-area">
                <h2>RPGForce</h2>
            </div>

            <div class="user-info">
                <div class="user-id">
                    <i class="fas fa-id-card"></i>
                    <span class="value" id="displayIdPc">--------</span>
                </div>
                
                <div class="user-nick">
                    <i class="fas fa-user"></i>
                    <span id="displayNickname">Aventureiro</span>
                </div>
                
                <button class="btn-sair" id="btnSair">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sair</span>
                </button>
            </div>
        </nav>

        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="dashboard-pc.html"><i class="fas fa-home"></i> Dashboard</a>
            <i class="fas fa-chevron-right"></i>
            <a href="personagens.html">Personagens</a>
            <i class="fas fa-chevron-right"></i>
            <span class="current">Criar Personagem</span>
        </div>

        <!-- Header -->
        <div class="page-header">
            <h1>
                <i class="fas fa-dragon"></i> 
                Criar Novo Personagem
            </h1>
        </div>

        <!-- Card Principal -->
        <div class="card">
            <!-- Dados Básicos -->
            <div class="card-section">
                <h2><i class="fas fa-user"></i> Dados Básicos</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="nomePersonagem">Nome do Personagem</label>
                        <input type="text" id="nomePersonagem" placeholder="Ex: Aric, o Caçador" maxlength="50">
                    </div>
                    
                    <div class="form-group">
                        <label for="classePersonagem">Classe</label>
                        <select id="classePersonagem">
                            <option value="guerreiro">Guerreiro</option>
                            <option value="mago">Mago</option>
                            <option value="ladino">Ladino</option>
                            <option value="clerigo">Clérigo</option>
                            <option value="barbaro">Bárbaro</option>
                        </select>
                    </div>
                </div>

                <!-- Upload Foto (opcional) -->
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-camera"></i>
                    <span>Clique para adicionar foto (opcional)</span>
                    <input type="file" id="fotoInput" accept="image/*" style="display: none;">
                </div>
                <div class="preview-area" id="previewArea" style="display: none;">
                    <img id="previewImage" src="" alt="Preview">
                    <button type="button" id="removeFoto" class="btn-remove"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <!-- NOVA SEÇÃO: APARÊNCIA E HISTÓRIA -->
            <div class="card-section">
                <h2><i class="fas fa-user-circle"></i> Aparência e História</h2>
                
                <div class="form-row">
                    <!-- Aparência -->
                    <div class="form-group">
                        <label for="aparencia">Aparência:</label>
                        <select id="aparencia">
                            <option value="feio">Feio (-2 reação)</option>
                            <option value="normal" selected>Normal</option>
                            <option value="atraente">Atraente (+2 reação)</option>
                        </select>
                    </div>
                    
                    <!-- Riqueza -->
                    <div class="form-group">
                        <label for="riqueza">Riqueza Inicial:</label>
                        <select id="riqueza">
                            <option value="pobre">Pobre (metade do dinheiro)</option>
                            <option value="medio" selected>Médio (normal)</option>
                            <option value="rico">Rico (5x dinheiro)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Peculiaridades -->
                <div class="form-group">
                    <label for="peculiaridades">Peculiaridades (personalidade, maneirismos, história):</label>
                    <textarea id="peculiaridades" rows="3" placeholder="Ex: Fala sozinho quando nervoso... Tem uma cicatriz no rosto... Adora poesia..."></textarea>
                </div>
            </div>

            <!-- Distribuição de Atributos -->
            <div class="card-section">
                <h2><i class="fas fa-chart-bar"></i> Atributos</h2>
                
                <div class="pontos-restantes">
                    <span>Pontos para distribuir:</span>
                    <span class="valor" id="pontosRestantes">6</span>
                </div>

                <!-- ST -->
                <div class="atributo-row" data-atributo="st">
                    <div class="atributo-info">
                        <span class="atributo-nome">ST (Força)</span>
                        <span class="atributo-valor" id="stValor">9</span>
                    </div>
                    <div class="bolinhas-container" id="stBolinhas"></div>
                    <div class="atributo-detalhes">
                        <span class="dano" id="stDano">1d-1</span>
                    </div>
                </div>

                <!-- DX -->
                <div class="atributo-row" data-atributo="dx">
                    <div class="atributo-info">
                        <span class="atributo-nome">DX (Destreza)</span>
                        <span class="atributo-valor" id="dxValor">5</span>
                    </div>
                    <div class="bolinhas-container" id="dxBolinhas"></div>
                    <div class="atributo-detalhes">
                        <span class="esquiva" id="dxEsquiva">Esquiva 5</span>
                    </div>
                </div>

                <!-- IQ -->
                <div class="atributo-row" data-atributo="iq">
                    <div class="atributo-info">
                        <span class="atributo-nome">IQ (Inteligência)</span>
                        <span class="atributo-valor" id="iqValor">5</span>
                    </div>
                    <div class="bolinhas-container" id="iqBolinhas"></div>
                    <div class="atributo-detalhes">
                        <span class="vontade" id="iqVontade">Vontade 5</span>
                    </div>
                </div>

                <!-- HT -->
                <div class="atributo-row" data-atributo="ht">
                    <div class="atributo-info">
                        <span class="atributo-nome">HT (Vigor)</span>
                        <span class="atributo-valor" id="htValor">48</span>
                    </div>
                    <div class="bolinhas-container" id="htBolinhas"></div>
                    <div class="atributo-detalhes">
                        <span class="vida" id="htVida">Vida 48</span>
                        <span class="fadiga" id="htFadiga">Fadiga 8</span>
                    </div>
                </div>
            </div>

            <!-- NOVA SEÇÃO: VANTAGENS -->
            <div class="card-section">
                <h2><i class="fas fa-star"></i> Vantagens <span style="font-size: 0.8rem; color: rgba(255,255,255,0.6);">(escolha 3 para começar)</span></h2>
                
                <div class="contador-vantagens">
                    <span><i class="fas fa-check-circle"></i> Vantagens selecionadas:</span>
                    <span id="contadorVantagens">0/3</span>
                </div>
                
                <div class="vantagens-grid" id="vantagensGrid">
                    <!-- Aliado -->
                    <div class="vantagem-card" data-vantagem="aliado">
                        <h3>Aliado <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Um companheiro fiel</p>
                    </div>
                    
                    <!-- Ambidestria -->
                    <div class="vantagem-card" data-vantagem="ambidestria">
                        <h3>Ambidestria <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Usa ambas as mãos sem penalidade</p>
                    </div>
                    
                    <!-- Aptidão mágica +1 -->
                    <div class="vantagem-card" data-vantagem="aptidaoMagica">
                        <h3>Aptidão mágica +1 <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Bônus em magias</p>
                    </div>
                    
                    <!-- Abascanto +3 -->
                    <div class="vantagem-card" data-vantagem="abascanto">
                        <h3>Abascanto +3 <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Resistência a magia +3</p>
                    </div>
                    
                    <!-- Carisma +1 -->
                    <div class="vantagem-card" data-vantagem="carisma">
                        <h3>Carisma +1 <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Persuasão, liderança</p>
                    </div>
                    
                    <!-- Destemor +2 -->
                    <div class="vantagem-card" data-vantagem="destemor">
                        <h3>Destemor +2 <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Resistência a medo/intimidação</p>
                    </div>
                    
                    <!-- Duro de matar +2 -->
                    <div class="vantagem-card" data-vantagem="duroMatar">
                        <h3>Duro de matar +2 <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Bônus em HT ou resistência</p>
                    </div>
                    
                    <!-- Flexibilidade -->
                    <div class="vantagem-card" data-vantagem="flexibilidade">
                        <h3>Flexibilidade <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Bônus em testes de DX/escapar</p>
                    </div>
                    
                    <!-- Intuição -->
                    <div class="vantagem-card" data-vantagem="intuicao">
                        <h3>Intuição <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Sentir quando algo está errado</p>
                    </div>
                    
                    <!-- Noção do perigo -->
                    <div class="vantagem-card" data-vantagem="nocaoPerigo">
                        <h3>Noção do perigo <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Alerta contra emboscadas</p>
                    </div>
                    
                    <!-- Reflexo de combate -->
                    <div class="vantagem-card" data-vantagem="reflexoCombate">
                        <h3>Reflexo de combate <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Iniciativa, esquiva</p>
                    </div>
                    
                    <!-- Regeneração -->
                    <div class="vantagem-card" data-vantagem="regeneracao">
                        <h3>Regeneração <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Recupera vida mais rápido</p>
                    </div>
                    
                    <!-- Sentidos aguçados +2 -->
                    <div class="vantagem-card" data-vantagem="sentidosAgucados">
                        <h3>Sentidos aguçados +2 <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Percepção +2</p>
                    </div>
                    
                    <!-- Sorte -->
                    <div class="vantagem-card" data-vantagem="sorte">
                        <h3>Sorte <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Pode rerolar testes</p>
                    </div>
                    
                    <!-- Visão noturna -->
                    <div class="vantagem-card" data-vantagem="visaoNoturna">
                        <h3>Visão noturna <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Enxerga no escuro</p>
                    </div>
                    
                    <!-- Mestre das armas -->
                    <div class="vantagem-card" data-vantagem="mestreArmas">
                        <h3>Mestre das armas <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Bônus com armas</p>
                    </div>
                    
                    <!-- Força de vontade +2 -->
                    <div class="vantagem-card" data-vantagem="forcaVontade">
                        <h3>Força de vontade +2 <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Resistência mental +2</p>
                    </div>
                    
                    <!-- Fadiga extra +2 -->
                    <div class="vantagem-card" data-vantagem="fadigaExtra">
                        <h3>Fadiga extra +2 <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">+2 na reserva de fadiga</p>
                    </div>
                    
                    <!-- HT extra +5% -->
                    <div class="vantagem-card" data-vantagem="htExtra">
                        <h3>HT extra +5% <span class="check"><i class="fas fa-check-circle"></i></span></h3>
                        <p class="resumo">Aumento percentual no Vigor</p>
                    </div>
                </div>
            </div>

            <!-- NOVA SEÇÃO: DESVANTAGENS -->
            <div class="card-section">
                <h2><i class="fas fa-skull"></i> Desvantagens</h2>
                <p style="color: rgba(255,255,255,0.6); margin-bottom: 15px; font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i> Opcionais. Clique para selecionar.
                </p>
                
                <div class="desvantagens-grid" id="desvantagensGrid">
                    <!-- Alcoolismo -->
                    <div class="desvantagem-card" data-desvantagem="alcoolismo">
                        <h3>Alcoolismo</h3>
                        <p class="resumo">Vício em bebida</p>
                    </div>
                    
                    <!-- Avareza -->
                    <div class="desvantagem-card" data-desvantagem="avareza">
                        <h3>Avareza</h3>
                        <p class="resumo">Mesquinho, ama dinheiro</p>
                    </div>
                    
                    <!-- Briguento -->
                    <div class="desvantagem-card" data-desvantagem="briguento">
                        <h3>Briguento</h3>
                        <p class="resumo">Adora uma briga</p>
                    </div>
                    
                    <!-- Barulhento +2 -->
                    <div class="desvantagem-card" data-desvantagem="barulhento">
                        <h3>Barulhento +2</h3>
                        <p class="resumo">Não consegue ser furtivo</p>
                    </div>
                    
                    <!-- Cobiça -->
                    <div class="desvantagem-card" data-desvantagem="cobica">
                        <h3>Cobiça</h3>
                        <p class="resumo">Quer tudo que vê</p>
                    </div>
                    
                    <!-- Circunspecção -->
                    <div class="desvantagem-card" data-desvantagem="circunspeccao">
                        <h3>Circunspecção</h3>
                        <p class="resumo">Cautela extrema</p>
                    </div>
                    
                    <!-- Cleptomania -->
                    <div class="desvantagem-card" data-desvantagem="cleptomania">
                        <h3>Cleptomania</h3>
                        <p class="resumo">Compulsão por roubar</p>
                    </div>
                    
                    <!-- Código de honra -->
                    <div class="desvantagem-card" data-desvantagem="codigoHonra">
                        <h3>Código de honra</h3>
                        <p class="resumo">Segue regras rígidas</p>
                    </div>
                    
                    <!-- Covardia -->
                    <div class="desvantagem-card" data-desvantagem="covardia">
                        <h3>Covardia</h3>
                        <p class="resumo">Foge de perigo</p>
                    </div>
                    
                    <!-- Daltonismo -->
                    <div class="desvantagem-card" data-desvantagem="daltonismo">
                        <h3>Daltonismo</h3>
                        <p class="resumo">Não vê cores</p>
                    </div>
                    
                    <!-- Senso do dever -->
                    <div class="desvantagem-card" data-desvantagem="sensoDever">
                        <h3>Senso do dever</h3>
                        <p class="resumo">Protege algo/alguém</p>
                    </div>
                    
                    <!-- Inimigo -->
                    <div class="desvantagem-card" data-desvantagem="inimigo">
                        <h3>Inimigo</h3>
                        <p class="resumo">Alguém te persegue</p>
                    </div>
                    
                    <!-- Excesso de confiança -->
                    <div class="desvantagem-card" data-desvantagem="excessoConfianca">
                        <h3>Excesso de confiança</h3>
                        <p class="resumo">Se acha mais capaz</p>
                    </div>
                    
                    <!-- Fobias (com modal) -->
                    <div class="desvantagem-card" id="cardFobia" data-desvantagem="fobia">
                        <h3>Fobia <i class="fas fa-chevron-right" style="font-size: 0.8rem;"></i></h3>
                        <p class="resumo">Clique para escolher</p>
                        <span class="badge-fobia" id="fobiaEscolhida" style="display: none;">Nenhuma</span>
                    </div>
                    
                    <!-- Fúria -->
                    <div class="desvantagem-card" data-desvantagem="furia">
                        <h3>Fúria</h3>
                        <p class="resumo">Perde o controle na raiva</p>
                    </div>
                    
                    <!-- Honestidade -->
                    <div class="desvantagem-card" data-desvantagem="honestidade">
                        <h3>Honestidade</h3>
                        <p class="resumo">Não consegue mentir</p>
                    </div>
                    
                    <!-- Luxúria -->
                    <div class="desvantagem-card" data-desvantagem="luxuria">
                        <h3>Luxúria</h3>
                        <p class="resumo">Obcecado por prazeres</p>
                    </div>
                    
                    <!-- Megalomania -->
                    <div class="desvantagem-card" data-desvantagem="megalomania">
                        <h3>Megalomania</h3>
                        <p class="resumo">Quer dominar o mundo</p>
                    </div>
                    
                    <!-- Pacifismo -->
                    <div class="desvantagem-card" data-desvantagem="pacifismo">
                        <h3>Pacifismo</h3>
                        <p class="resumo">Não suporta violência</p>
                    </div>
                    
                    <!-- Piromania -->
                    <div class="desvantagem-card" data-desvantagem="piromania">
                        <h3>Piromania</h3>
                        <p class="resumo">Adora fogo</p>
                    </div>
                    
                    <!-- Preguiça -->
                    <div class="desvantagem-card" data-desvantagem="preguica">
                        <h3>Preguiça</h3>
                        <p class="resumo">Evita esforço</p>
                    </div>
                    
                    <!-- Sanguinolência -->
                    <div class="desvantagem-card" data-desvantagem="sanguinolencia">
                        <h3>Sanguinolência</h3>
                        <p class="resumo">Adora ver sangue</p>
                    </div>
                    
                    <!-- Teimosia -->
                    <div class="desvantagem-card" data-desvantagem="teimosia">
                        <h3>Teimosia</h3>
                        <p class="resumo">Não muda de ideia</p>
                    </div>
                    
                    <!-- Veracidade -->
                    <div class="desvantagem-card" data-desvantagem="veracidade">
                        <h3>Veracidade</h3>
                        <p class="resumo">Sempre fala a verdade</p>
                    </div>
                    
                    <!-- Zarolho -->
                    <div class="desvantagem-card" data-desvantagem="zarolho">
                        <h3>Zarolho</h3>
                        <p class="resumo">Tem só um olho</p>
                    </div>
                    
                    <!-- Magro -->
                    <div class="desvantagem-card" data-desvantagem="magro">
                        <h3>Magro</h3>
                        <p class="resumo">-20% peso, vulnerável a quedas</p>
                    </div>
                    
                    <!-- Gordo -->
                    <div class="desvantagem-card" data-desvantagem="gordo">
                        <h3>Gordo</h3>
                        <p class="resumo">+20% peso, perde fadiga rápido</p>
                    </div>
                    
                    <!-- Nanismo -->
                    <div class="desvantagem-card" data-desvantagem="nanismo">
                        <h3>Nanismo</h3>
                        <p class="resumo">-1 deslocamento, altura máx 1.30m</p>
                    </div>
                </div>
            </div>

            <!-- Status e Derivados -->
            <div class="card-section status-grid">
                <div class="status-item">
                    <span class="label">Vida:</span>
                    <span class="value" id="statusVida">48</span>
                </div>
                <div class="status-item">
                    <span class="label">Fadiga:</span>
                    <span class="value" id="statusFadiga">8</span>
                </div>
                <div class="status-item">
                    <span class="label">Mana:</span>
                    <span class="value" id="statusMana">53</span>
                </div>
                <div class="status-item">
                    <span class="label">Dano:</span>
                    <span class="value" id="statusDano">1d-1</span>
                </div>
                <div class="status-item">
                    <span class="label">Esquiva:</span>
                    <span class="value" id="statusEsquiva">5</span>
                </div>
                <div class="status-item">
                    <span class="label">Deslocamento:</span>
                    <span class="value" id="statusDeslocamento">4.8</span>
                </div>
            </div>

            <!-- Botões -->
            <div class="card-actions">
                <button type="button" class="btn-secondary" onclick="history.back()">
                    <i class="fas fa-arrow-left"></i> Cancelar
                </button>
                <button type="button" class="btn-primary" id="btnCriarPersonagem">
                    <i class="fas fa-save"></i> Criar Personagem
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        // Firebase Config
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { 
            getAuth, 
            signOut,
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import { 
            getFirestore, 
            doc,
            setDoc,
            collection,
            getDoc
        } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBrx4JSmFay24k95pu1ICjFfVki8gs_uHw",
            authDomain: "rpgforce-e3227.firebaseapp.com",
            projectId: "rpgforce-e3227",
            storageBucket: "rpgforce-e3227.firebasestorage.app",
            messagingSenderId: "984517342332",
            appId: "1:984517342332:web:87d33aa4c84ff2a07685f9"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ========== ELEMENTOS DOM ==========
        const displayIdPc = document.getElementById('displayIdPc');
        const displayNickname = document.getElementById('displayNickname');
        const btnSair = document.getElementById('btnSair');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const btnCriar = document.getElementById('btnCriarPersonagem');
        
        // Upload
        const uploadArea = document.getElementById('uploadArea');
        const fotoInput = document.getElementById('fotoInput');
        const previewArea = document.getElementById('previewArea');
        const previewImage = document.getElementById('previewImage');
        const removeFoto = document.getElementById('removeFoto');

        // Modal
        const modalFobias = document.getElementById('modalFobias');
        const fecharModalFobias = document.getElementById('fecharModalFobias');
        const fobiaEscolhida = document.getElementById('fobiaEscolhida');
        const cardFobia = document.getElementById('cardFobia');

        // ========== ESTADO GLOBAL ==========
        // Atributos
        let pontosRestantes = 6;
        const atributos = {
            st: { valor: 9, bolinhas: 0, base: 9 },
            dx: { valor: 5, bolinhas: 0, base: 5 },
            iq: { valor: 5, bolinhas: 0, base: 5 },
            ht: { valor: 48, bolinhas: 0, base: 48 }
        };

        // Vantagens selecionadas (máx 3)
        const vantagensSelecionadas = new Set();
        const vantagensCards = document.querySelectorAll('.vantagem-card');
        const contadorVantagensSpan = document.getElementById('contadorVantagens');

        // Desvantagens selecionadas (sem limite)
        const desvantagensSelecionadas = new Set();
        const desvantagensCards = document.querySelectorAll('.desvantagem-card:not(#cardFobia)');
        let fobiaSelecionada = null;

        // Tabela de dano ST
        const tabelaDano = {
            9: "1d-1", 10: "1d", 11: "1d+1", 12: "1d+2",
            13: "2d-1", 14: "2d", 15: "2d+1", 16: "2d+2",
            17: "3d-1", 18: "3d", 19: "3d+1", 20: "3d+2"
        };

        // ========== FUNÇÕES DE LOADING ==========
        function showLoading() { loadingOverlay.classList.add('active'); }
        function hideLoading() { loadingOverlay.classList.remove('active'); }

        // ========== FUNÇÕES DOS ATRIBUTOS ==========
        function calcularDerivados() {
            // ST - Dano
            const st = atributos.st.valor;
            const dano = tabelaDano[st] || "1d-1";
            document.getElementById('stDano').textContent = dano;
            
            // DX - Esquiva (DX/2 + 3)
            const dx = atributos.dx.valor;
            const esquiva = Math.floor(dx / 2) + 3;
            document.getElementById('dxEsquiva').textContent = `Esquiva ${esquiva}`;
            
            // IQ - Vontade (IQ)
            const iq = atributos.iq.valor;
            document.getElementById('iqVontade').textContent = `Vontade ${iq}`;
            
            // HT - Vida e Fadiga
            const ht = atributos.ht.valor;
            const fadiga = 8 + atributos.ht.bolinhas;
            document.getElementById('htVida').textContent = `Vida ${ht}`;
            document.getElementById('htFadiga').textContent = `Fadiga ${fadiga}`;
            
            // Status Grid
            document.getElementById('statusVida').textContent = ht;
            document.getElementById('statusFadiga').textContent = fadiga;
            document.getElementById('statusMana').textContent = iq + ht;
            document.getElementById('statusDano').textContent = dano;
            document.getElementById('statusEsquiva').textContent = esquiva;
            document.getElementById('statusDeslocamento').textContent = (ht / 10).toFixed(1);
        }

        function criarBolinhas(atributoId, totalBolinhas = 15) {
            const container = document.getElementById(`${atributoId}Bolinhas`);
            if (!container) return;
            
            container.innerHTML = '';
            
            for (let i = 0; i < totalBolinhas; i++) {
                const bolinha = document.createElement('div');
                bolinha.className = 'bolinha';
                bolinha.dataset.index = i;
                bolinha.dataset.atributo = atributoId;
                
                bolinha.addEventListener('click', () => {
                    const atributo = atributos[atributoId];
                    const clicada = i < atributo.bolinhas;
                    
                    if (!clicada && pontosRestantes > 0) {
                        atributo.bolinhas++;
                        atributo.valor = atributo.base + atributo.bolinhas;
                        pontosRestantes--;
                    } else if (clicada) {
                        atributo.bolinhas--;
                        atributo.valor = atributo.base + atributo.bolinhas;
                        pontosRestantes++;
                    }
                    
                    atualizarInterface();
                });
                
                container.appendChild(bolinha);
            }
            
            atualizarBolinhas(atributoId);
        }

        function atualizarBolinhas(atributoId) {
            const container = document.getElementById(`${atributoId}Bolinhas`);
            if (!container) return;
            
            const bolinhas = container.children;
            const qtdPreenchidas = atributos[atributoId].bolinhas;
            
            for (let i = 0; i < bolinhas.length; i++) {
                if (i < qtdPreenchidas) {
                    bolinhas[i].classList.add('preenchida');
                } else {
                    bolinhas[i].classList.remove('preenchida');
                }
            }
        }

        function atualizarInterface() {
            document.getElementById('stValor').textContent = atributos.st.valor;
            document.getElementById('dxValor').textContent = atributos.dx.valor;
            document.getElementById('iqValor').textContent = atributos.iq.valor;
            document.getElementById('htValor').textContent = atributos.ht.valor;
            
            document.getElementById('pontosRestantes').textContent = pontosRestantes;
            
            atualizarBolinhas('st');
            atualizarBolinhas('dx');
            atualizarBolinhas('iq');
            atualizarBolinhas('ht');
            
            calcularDerivados();
        }

        // Inicializar bolinhas
        criarBolinhas('st');
        criarBolinhas('dx');
        criarBolinhas('iq');
        criarBolinhas('ht');

        // ========== FUNÇÕES DAS VANTAGENS ==========
        function atualizarContadorVantagens() {
            contadorVantagensSpan.textContent = `${vantagensSelecionadas.size}/3`;
        }

        function selecionarVantagem(card) {
            const vantagemId = card.dataset.vantagem;
            
            if (vantagensSelecionadas.has(vantagemId)) {
                // Desselecionar
                vantagensSelecionadas.delete(vantagemId);
                card.classList.remove('selecionada');
            } else {
                // Selecionar (se tiver menos de 3)
                if (vantagensSelecionadas.size < 3) {
                    vantagensSelecionadas.add(vantagemId);
                    card.classList.add('selecionada');
                } else {
                    alert('Você já selecionou 3 vantagens!');
                }
            }
            
            atualizarContadorVantagens();
        }

        // Adicionar evento às vantagens
        vantagensCards.forEach(card => {
            card.addEventListener('click', () => selecionarVantagem(card));
        });

        // ========== FUNÇÕES DAS DESVANTAGENS ==========
        function selecionarDesvantagem(card) {
            const desvantagemId = card.dataset.desvantagem;
            
            if (desvantagensSelecionadas.has(desvantagemId)) {
                desvantagensSelecionadas.delete(desvantagemId);
                card.style.background = 'rgba(0, 0, 0, 0.3)';
                card.style.borderColor = 'rgba(255, 215, 0, 0.2)';
            } else {
                desvantagensSelecionadas.add(desvantagemId);
                card.style.background = 'rgba(255, 0, 0, 0.2)';
                card.style.borderColor = '#ff6b6b';
            }
        }

        // Adicionar evento às desvantagens (exceto Fobia)
        desvantagensCards.forEach(card => {
            card.addEventListener('click', () => selecionarDesvantagem(card));
        });

        // ========== MODAL DE FOBIAS ==========
        cardFobia.addEventListener('click', () => {
            modalFobias.classList.add('active');
        });

        fecharModalFobias.addEventListener('click', () => {
            modalFobias.classList.remove('active');
        });

        // Clicar fora para fechar
        modalFobias.addEventListener('click', (e) => {
            if (e.target === modalFobias) {
                modalFobias.classList.remove('active');
            }
        });

        // Escolher fobia
        document.querySelectorAll('.fobia-item').forEach(item => {
            item.addEventListener('click', () => {
                const fobia = item.dataset.fobia;
                const nomeFobia = item.querySelector('h4').textContent;
                
                fobiaSelecionada = fobia;
                
                // Atualizar card
                fobiaEscolhida.style.display = 'inline-block';
                fobiaEscolhida.textContent = nomeFobia;
                cardFobia.style.background = 'rgba(255, 0, 0, 0.2)';
                cardFobia.style.borderColor = '#ff6b6b';
                
                // Adicionar à lista de desvantagens
                desvantagensSelecionadas.add(`fobia:${fobia}`);
                
                // Fechar modal
                modalFobias.classList.remove('active');
            });
        });

        // ========== UPLOAD DE FOTO ==========
        uploadArea.addEventListener('click', () => fotoInput.click());
        
        fotoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImage.src = e.target.result;
                    previewArea.style.display = 'block';
                    uploadArea.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        });

        removeFoto.addEventListener('click', () => {
            previewArea.style.display = 'none';
            uploadArea.style.display = 'block';
            fotoInput.value = '';
        });

        // ========== AUTENTICAÇÃO ==========
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const docRef = doc(db, "usuarios", user.uid);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const userData = docSnap.data();
                    displayIdPc.textContent = userData.id_pc || '--------';
                    displayNickname.textContent = userData.nickname || 'Aventureiro';
                }
            } else {
                window.location.href = 'index.html';
            }
        });

        btnSair.addEventListener('click', async () => {
            try {
                showLoading();
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Erro ao sair:', error);
                hideLoading();
            }
        });

        // ========== CRIAR PERSONAGEM ==========
        btnCriar.addEventListener('click', async () => {
            const nome = document.getElementById('nomePersonagem').value.trim();
            
            if (!nome) {
                alert('Digite um nome para o personagem');
                return;
            }

            if (pontosRestantes > 0) {
                alert(`Você ainda tem ${pontosRestantes} pontos para distribuir`);
                return;
            }

            try {
                showLoading();
                const user = auth.currentUser;
                
                // Criar ID único
                const personagemRef = doc(collection(db, "personagens"));
                const personagemId = personagemRef.id;

                // Calcular valores finais
                const dx = atributos.dx.valor;
                const iq = atributos.iq.valor;
                const ht = atributos.ht.valor;
                const fadiga = 8 + atributos.ht.bolinhas;
                const mana = iq + ht;
                const esquiva = Math.floor(dx / 2) + 3;
                const dano = tabelaDano[atributos.st.valor] || "1d-1";

                // Coletar dados dos selects
                const aparencia = document.getElementById('aparencia').value;
                const riqueza = document.getElementById('riqueza').value;
                const peculiaridades = document.getElementById('peculiaridades').value.trim();

                const personagemData = {
                    id: personagemId,
                    userId: user.uid,
                    nome: nome,
                    classe: document.getElementById('classePersonagem').value,
                    fotoURL: previewImage.src || '',
                    
                    aparencia: aparencia,
                    riqueza: riqueza,
                    peculiaridades: peculiaridades,
                    
                    vantagens: Array.from(vantagensSelecionadas),
                    desvantagens: Array.from(desvantagensSelecionadas),
                    fobia: fobiaSelecionada,
                    
                    pontos: {
                        xp: 0,
                        xpTotal: 0,
                        pm: 0,
                        dinheiro: riqueza === 'pobre' ? 25 : riqueza === 'rico' ? 250 : 50
                    },
                    
                    atributos: {
                        st: { bolinhas: atributos.st.bolinhas, valor: atributos.st.valor, base: 9 },
                        dx: { bolinhas: atributos.dx.bolinhas, valor: dx, base: 5 },
                        iq: { bolinhas: atributos.iq.bolinhas, valor: iq, base: 5 },
                        ht: { bolinhas: atributos.ht.bolinhas, valor: ht, base: 48 }
                    },
                    
                    status: {
                        vidaAtual: ht,
                        vidaMax: ht,
                        fadigaAtual: fadiga,
                        fadigaMax: fadiga,
                        manaAtual: mana,
                        manaMax: mana
                    },
                    
                    derivados: {
                        danoBase: dano,
                        esquiva: esquiva,
                        vontade: iq,
                        percepcao: iq,
                        deslocamento: (ht / 10).toFixed(1)
                    },
                    
                    reacao: {
                        base: aparencia === 'feio' ? -2 : aparencia === 'atraente' ? 2 : 0,
                        total: aparencia === 'feio' ? -2 : aparencia === 'atraente' ? 2 : 0
                    },
                    
                    createdAt: new Date(),
                    updatedAt: new Date()
                };

                await setDoc(personagemRef, personagemData);
                
                // Redirecionar
                window.location.href = `aventura-solo.html?personagemId=${personagemId}`;
                
            } catch (error) {
                console.error('Erro ao criar:', error);
                alert('Erro ao criar personagem. Tente novamente.');
                hideLoading();
            }
        });
    </script>
</body>
</html>